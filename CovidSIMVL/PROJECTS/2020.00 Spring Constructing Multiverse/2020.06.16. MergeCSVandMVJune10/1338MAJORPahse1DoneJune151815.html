<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<style>



#pane1 {
  left:100px;
  top: 25px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane2 {
  left:400px;
  top: 25px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane3 {
  left:700px;
  top: 25px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane4 {
  left:100px;
  top: 325px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane5 {
  left:400px;
  top: 325px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane6 {
  left:700px;
  top: 325px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane7 {
  left:100px;
  top: 625px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane8 {
  left:400px;
  top: 625px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}

#pane9 {
  left:700px;
  top: 625px;
  padding: 5px;
  border-width:1px;
  cursor:pointer;
  height:300px;
  width:300px;
  position: absolute;
}



#windowpane {
  display: block;
}


#controls {
  display: block;
  left:8px;
  top:3px;
  position: absolute;
}

#MV-menu {
  top: 25px;
  left: 1050px;
  width:400px;
  height:30px;
  position: absolute;
  display: block;
}

#MVmatrix {
  top: 150px;
  left:1050px;
  position: absolute;
  display: none;
}




/* *********************************************************************************************
  $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

                        THIS PART DEALS WITH INDIVIDUAL UNIVERSES IN THE LARGE

  **********************************************************************************************
*/
table {
  border-collapse: collapse;
  padding:5px;
  font-family: arial, sans-serif;
  font-style: normal;
  font-size: 13px
}

th,  td {
  border: 1px solid black;
  padding:3px;
  text-align: center;
}
th {
    cursor: pointer;
}
td {
  height:
}

#myTab {
  display: none;
  position: absolute;
  width: 1600px;
  top:25px;
  left:6px;
}

#AgeTab {
  display: none;
}

#RaceTab {
  display: none;
}

#chartContainer1 {
    border: 1px solid black;
    position: absolute;
    left: 820px;
    top: 240px;
    width:380px;
    height:120px;
    display: block;
    z-index: +3;
}

#chartContainer2 {
    border: 1px solid blue;
    position: absolute;
    left: 820px;
    top: 365px;
    width:380px;
    height:120px;
    display: block;
    z-index: +3;
}

#chartContainer3 {
    border: 1px solid orange;
    position: absolute;
    left: 820px;
    top: 490px;
    width:380px;
    height:165px;
    display: block;
    z-index: +3;
}

#chartContainer4 {
    border: 1px solid green;
    position: absolute;
    left: 820px;
    top: 660px;
    width:380px;
    height:180px;
    display: block;
    z-index: +3;
}

#chartContainer6 {
    border: 1px solid pink;
    position: absolute;
    left: 820px;
    top: 87px;
    height:150px;
    width:380px;
    display: block;
    z-index: +3;
}


#chartContainer7 {
    border: 1px solid pink;
    position: absolute;
    left: 100px;
    top: 78px;
    display: block;
    z-index: +3;
}

#chartContainer8 {
    border: 1px solid pink;
    position: absolute;
    left: 400px;
    top:78px;
    display: block;
    z-index: +3;
}

#chartContainer9 {
    border: 1px solid pink;
    position: absolute;
    left: 700px;
    top:  78px;
    display: block;
    z-index: +3;
}

#chartContainer10 {
    border: 1px solid pink;
    position: absolute;
    left: 100px;
    top: 378px;
    display: block;
    z-index: +3;
}

#chartContainer11 {
    border: 1px solid pink;
    position: absolute;
    left: 400px;
    top: 378px;
    display: block;
    z-index: +3;
}

#chartContainer12 {
  border: 1px solid pink;
  position: absolute;
  left: 700px;
  top:  378px;
  display: block;
  z-index: +3;
}

#chartContainer13 {
  border: 1px solid pink;
  position: absolute;
  left: 100px;
  top:  678px;
  display: block;
  z-index: +5;
}

#chartContainer14 {
  border: 1px solid pink;
  position: absolute;
  left: 400px;
  top:678px;
  display: block;
  z-index: +3;
}

#chartContainer15 {
  border: 1px solid pink;
  position: absolute;
  left: 700px;
  top:678px;
  display: block;
  z-index: +3;
}

#chartContainer16 {
    border: 1px solid lightGray;
    position: absolute;
    left: 1050px;
    top: 78px;
    height:150px;
    width:300px;
    display: block;
    z-index: +4;
}

#chartContainer17 {
  border: 1px solid lightGray;
  position: absolute;
  left: 1050px;
  top:  228px;
  height:150px;
  width:300px;
  display: block;
  z-index: +3;
}

#chartContainer18 {
  border: 1px solid lightGray;
  position: absolute;
  left: 1050px;
  top:  378px;
  height:150px;
  width:300px;
  display: block;
  z-index: +5;
}

#chartContainer19 {
  border: 1px solid lightGray;
  position: absolute;
  left: 1050px;
  top:528px;
  height:150px;
  width:300px;
  display: block;
  z-index: +3;
}

#chartContainer20 {
  border: 1px solid lightGray;
  position: absolute;
  left: 1050px;
  top:678px;
  height:150px;
  width:300px;
  display: block;
  z-index: +3;
}



#MVcharts {
  position: absolute;
  display: none;
}

#myCanvas {
  display: block;
  position: absolute;
  left:100px;
  top:300px;
  z-index:+3;
}

#gameCanvas {
  position: absolute;
  display: block;
  left:8px;
  top:240px;

}

#day {
  position: absolute;
  left:5px;
  top:30px;
  width:90px;
  height: 90px;
}

#hour {
  position: absolute;
  left:5px;
  top:120px;
  width:90px;
  height: 90px;
}

#dayhr {
  display: none;
}

#getFile {
  position: absolute;
  display:block;
  left:30px;
  top:145px;
  z-index:+4;
}

#localCharts {
  display: block;
}


</style>
</head>

<!-- *******************************************************************************************
     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

                   NOW WE START THE CSS SECTION AND IT RELATES FIRST TO MULTIVERSE

     &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
-->

<body>

<div id="getFile">
    <form class="form-horizontal well">
      <fieldset>
          <label for="csvFileInput"> <strong>Mounir Messelmeni 2012<br><br>CSV File:</strong>
          </label>
          <input type="file" id="csvFileInput" onchange="handleFiles(this.files)"
          accept=".csv">
        </div>
      </fieldset>
    </form>
</div>

<div id="windowpane">
    <div id="pane1"  onclick=selPane1() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane1 is here</div>
    <div id="pane2"  onclick=selPane2() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane2</div>
    <div id="pane3"  onclick=selPane3() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane3</div>
    <div id="pane4"  onclick=selPane4() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane4</div>
    <div id="pane5"  onclick=selPane5() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane5</div>
    <div id=pane6  onclick=selPane6() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane6</div>
    <div id=pane7  onclick=selPane7() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane7</div>
    <div id=pane8  onclick=selPane8() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane8</div>
    <div id=pane9  onclick=selPane9() style="background-color:MidnightBlue; border-color:red; border-style:solid;">Pane9</div>
</div>



    <div id="fields">
        <canvas id="canp1" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp2" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp3" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp4" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp5" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp6" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp7" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp8" style="position:absolute; border: 1px solid blue"></canvas>
        <canvas id="canp9" style="position:absolute; border: 1px solid blue"></canvas>
    </div>

    <div>
        <table ID="MV-menu">
          <tr>
            <th onclick="loadMVnames()">NAMES</th>
            <th onclick="MVmatrix()">matrix</th>
            <th id = "rBlue" onclick="rBlues()">make some Blue</th>
          </tr>
          <tr>
            <td id="MV-name">universe 1</td>
            <td>trafficking</td>
            <td id="rBlueNum">visit the stars</td>
          </tr>
        </table>
    </div>

    <div>
      <table id="MVmatrix">
      <tr>
        <th> UNIVERSES AS SPACES </th>
      </tr>
        <tr> <td id="row1" onclick="mxRow1()" style="cursor:pointer">row1</td> </tr>
        <tr> <td id=row2 onclick="mxRow2()" style="cursor:pointer">row2</td> </tr>
        <tr> <td id=row3 onclick="mxRow3()" style="cursor:pointer">row3</td> </tr>
        <tr> <td id=row4 onclick="mxRow4()" onmousemove="mouseMove4()" style="cursor:pointer">row4</td></tr>
        <tr> <td id=row5 onclick="mxRow5()" style="cursor:pointer">row5</td> </tr>
        <tr> <td id=row6 onclick="mxRow6()" style="cursor:pointer">row6</td> </tr>
        <tr> <td id=row7 onclick="mxRow7()" style="cursor:pointer">row7</td> </tr>
        <tr> <td id=row8 onclick="mxRow8()" style="cursor:pointer">row8</td> </tr>
        <tr> <td id=row9 onclick="mxRow9()" style="cursor:pointer">row9</td> </tr>
      <tr>
      </table>
    </div>

    <div id="controls">
      <button onclick="hideMV()" type="button" style="background-color:midnightblue;color:white;cursor:pointer">MV toggle</button>
      <button onclick="rBlues()" type="button" style="background-color:cadetblue;color:white;cursor:pointer">Add Blue</button>
      <button onclick="startClock()" type="button" style="background-color:green;color:white;cursor:pointer">start</button>
      <button id="popClick" onclick="nextHour()" style="background-color:red" type="button" style="cursor:pointer">Hour++</button>
      <button id="showBut" onclick="showU()" type="button" style="cursor:pointer">Show U</button>
      <button onclick="startIt()" type="button" style="cursor:pointer">single</button>
      <button type="button" style="background-color:LightSlateGrey;color:white">FROM ddhh:</button>
      <button type="button" style="background-color:linen">&nbsp0000&nbsp</button>
      <button onclick="getToTime()" style="background-color:LightslateGrey;color:white;cursor:pointer">TO ddhh:&nbsp&nbsp</button>
      <button id="toHHDD"  style="background-color:linen">&nbsp&nbsphhdd&nbsp&nbsp</button>
    </div>

    <div id="dayhr">
      <button id="day" type="button">DAY:</button>
      <button id="hour" type="button">HOUR:</button>
    </div>







<!--   ***************************************************************************
       $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
       &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

          FROM THIS PART ON, IT'S ALL ABOUT INDIVIDUAL UNIVERSES
                   THE STUFF ABOVE IS ABOUT THE MULTIVERSE

-->

<div class="topnav">
  <table ID="myTab">
    <tr>
      <th bgcolor=Green style="color:white"> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</th>
      <th bgcolor=Yellow> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</th>
      <th bgcolor=Blue style="color:white"> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</th>
      <th bgcolor=Red style="color:white"> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp </th>
      <th bgcolor=Orange> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</th>
      <th bgcolor=black style="font-size:10px; color:white">&nbspTotals&nbsp&nbsp&nbsp</th>
      <th bgcolor=Beige style="font-size:10px">Resident</th>
      <th bgcolor=Beige style="font-size:10px">Attached</th>
      <th bgcolor=Beige style="font-size:10px">Visitor</th>
      <th bgcolor=black> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</th>
      <th onclick="showIncD()" bgcolor=lightGray>Incubation</th>
      <th onclick="showInfD()" bgcolor=LightGray>Asympt Inf</th>
      <th onclick="showCliD()" bgcolor=lightGray>Sick or Dx</th>
      <th onclick="showCycle()" bgcolor=lightGray>&nbsp Cycles &nbsp</th>
      <th onclick="showPradius()" bgcolor=lightGray>PP Radius</th>
      <th onclick="endChart()">Show MVcharts</th>
      <th id="ageSel" onclick="selAgeRisk()" bgcolor=red style="cursor:pointer">Age Group Risk</th>
    </tr>
    <tr>
      <td id="grCt">1</td>
      <td id="yeCt">0</td>
      <td id="blCt">0</td>
      <td id="reCt">0</td>
      <td id="orCt">0</td>
      <td id="popStat" bgcolor=black style="color:white; font-size:10px"></td>
      <td id="resCt">0</td>
      <td id="attCt">0</td>
      <td id="visCt">0</td>
      <td bgcolor=black style="color:white; border:white">Status</td>
      <td id="dIncD">2</td>
      <td id="dInfD">5</td>
      <td id="dCliD">1</td>
      <td id="dCycl">1</td>
      <td id="dPrad">20</td>
      <td></td>
      <td onclick="selRaceRisk()" bgcolor=red style="cursor:pointer">Race Based Risk</td>
    </tr>
    <tr bgcolor=lightgray>
      <td id=GArr>0</td>
      <td id=YArr>0</td>
      <td id=BArr>0</td>
      <td id=RArr>0</td>
      <td id=OArr>0</td>
      <td id="arrStat" bgcolor=DarkGray style="color:white; font-size:10px"></td>
      <td id=ResArr>0</td>
      <td id=AttArr>0</td>
      <td id=VisArr>0</td>
      <td bgcolor=DarkGray style="color:white">Arrive</td>
    </tr>
    <td id=GDep>0</td>
    <td id=YDep>0</td>
    <td id=BDep>0</td>
    <td id=RDep>0</td>
    <td id=ODep>0</td>
    <td id="depStat" bgcolor=black style="color:white; fontisize:10px"></td>
    <td id=ResDep>0</td>
    <td id=AttDep>0</td>
    <td id=VisDep>0</td>
    <td bgcolor=black style="color:white">Depart</td>
  </tr>

  </table>
</div>

<div id="localCharts">
    <div id="chartContainer1"></div>
    <div id="chartContainer2"></div>
    <div id="chartContainer3"></div>
    <div id="chartContainer4"></div>

    <div id="chartContainer6"></div>
</div>

 <div id="MVcharts">
    <div id="chartContainer7" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer8" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer9" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer10" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer11" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer12" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer13" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer14" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer15" style="height: 150px; width: 300px; display: block;"></div>
    <div id="chartContainer16"></div>
    <div id="chartContainer17"></div>
    <div id="chartContainer18"></div>
    <div id="chartContainer19"></div>
    <div id="chartContainer20"></div>
</div>

<div class=info>


    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>



<!-- &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
     *********************************************************************************************
                        THESE COME FROM TIMERS MODULE
     ---------------------------------------------------------------------------------------------
     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->

<canvas id="gameCanvas" width="800" height="600"></canvas>


<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->



<script>

var fullCt =  0;
var VIEW = "local";
var MODE = "manual";              // or "MV" - master controller of behavior

(function() {hideMV()})();
// *********************************** CREATE CANVASES FOR EACH PANE *******************************

var i,j,k = 0;

async function drawc(x,y,rad,color,ctx){
  ctx.beginPath();
  ctx.arc(x,y,rad,0,2*Math.PI);
  ctx.fillStyle = color;
  ctx.fill();
  ctx.stroke();
  ctx.strokeStyle = "black";
}


function CreateCanvases() {
  this.cid;
  this.width;
  this.height;
  this.style.top;
  this.style.left;
  this.ctx;
}

var cn = [];
var offX = 75;
var offY = 100;
var pHz = "300"+"px";
var pVt = (200).toString()+"px";

var c = document.getElementById("fields").children;

for (i=0; i< c.length; i++){
  var x = 0;
  var y = 0;
  cn[i] = document.getElementById(c[i].id);
  cn[i].cid = c[i].id;
  cn[i].width = 300;
  cn[i].height = 250;
  cn[i].style.top = ((x%3)*300+offX).toString()+"px";
  cn[i].style.left = ((y%3)*300+offY).toString()+"px";
  x++;
  y++;
  cn[i].ctx = cn[i].getContext("2d");
}




var canp1 = document.getElementById("canp1");
canp1.width = 300;
canp1.height = 250;
canp1.style.top = "75px";
canp1.style.left = "100px";

var ctx1 = canp1.getContext("2d");


ctx1.fillStyle = "MidnightBlue";
ctx1.fillRect(0,0,canp1.width, canp1.height);
drawc(10,10,8,"green",ctx1);
/*
canp1.addEventListener("mousemove", mouseMove1, {passive:true});
canp1.addEventListener("mouseout", mouseOut1, {passive:true});
canp1.addEventListener("click", mouseClick1, {passive:true});
*/



// ********************************************************

var canp2 = document.getElementById("canp2");
canp2.width = 300;
canp2.height = 250;
canp2.style.top = "75px";
canp2.style.left = "400px";

var ctx2 = canp2.getContext("2d");


ctx2.fillStyle = "MidnightBlue";
ctx2.fillRect(0,0,canp2.width, canp2.height);
drawc(10,10,8,"green",ctx2);
/*
canp2.addEventListener("mousemove", mouseMove2, {passive:true});
canp2.addEventListener("mouseout", mouseOut2, {passive:true});
canp2.addEventListener("click", mouseClick2, {passive:true});
*/
// *********************************************************************

var canp3 = document.getElementById("canp3");
canp3.width = 300;
canp3.height = 250;
canp3.style.top = "75px";
canp3.style.left = "700px";

var ctx3 = canp3.getContext("2d");


ctx3.fillStyle = "MidnightBlue";
ctx3.fillRect(0,0,canp3.width, canp3.height);
drawc(10,10,8,"green",ctx3);
/*
canp3.addEventListener("mousemove", mouseMove3, {passive:true});
canp3.addEventListener("mouseout", mouseOut3, {passive:true});
canp3.addEventListener("click", mouseClick3, {passive:true});
*/
// ********************************************************

var canp4 = document.getElementById("canp4");
canp4.width = 300;
canp4.height = 250;
canp4.style.top = "375px";
canp4.style.left = "100px";

var ctx4 = canp4.getContext("2d");


ctx4.fillStyle = "MidnightBlue";
ctx4.fillRect(0,0,canp4.width, canp4.height);
drawc(10,10,8,"green",ctx4);
/*
canp4.addEventListener("mousemove", mouseMove4, {passive:true});
canp4.addEventListener("mouseout", mouseOut4, {passive:true});
canp4.addEventListener("click", mouseClick4, {passive:true});
*/
// ********************************************************

var canp5 = document.getElementById("canp5");
canp5.width = 300;
canp5.height = 250;
canp5.style.top = "374px";
canp5.style.left = "400px";

var ctx5 = canp5.getContext("2d");


ctx5.fillStyle = "MidnightBlue";
ctx5.fillRect(0,0,canp5.width, canp5.height);
drawc(10,10,8,"green",ctx5);
/*
canp5.addEventListener("mousemove", mouseMove5, {passive:true});
canp5.addEventListener("mouseout", mouseOut5, {passive:true});
canp5.addEventListener("click", mouseClick5, {passive:true});
*/
// ********************************************************

var canp6 = document.getElementById("canp6");
canp6.width = 300;
canp6.height = 250;
canp6.style.top = "375px";
canp6.style.left = "700px";

var ctx6 = canp6.getContext("2d");


ctx6.fillStyle = "MidnightBlue";
ctx6.fillRect(0,0,canp6.width, canp6.height);
drawc(10,10,8,"green",ctx6);
/*
canp6.addEventListener("mousemove", mouseMove6, {passive:true});
canp6.addEventListener("mouseout", mouseOut6, {passive:true});
canp6.addEventListener("click", mouseClick6, {passive:true});
*/
// ********************************************************

var canp7 = document.getElementById("canp7");
canp7.width = 300;
canp7.height = 250;
canp7.style.top = "675px";
canp7.style.left = "100px";

var ctx7 = canp7.getContext("2d");


ctx7.fillStyle = "MidnightBlue";
ctx7.fillRect(0,0,canp7.width, canp7.height);
drawc(10,10,8,"green",ctx7);
/*
canp7.addEventListener("mousemove", mouseMove7, {passive:true});
canp7.addEventListener("mouseout", mouseOut7, {passive:true});
canp7.addEventListener("click", mouseClick7, {passive:true});
*/
// ********************************************************

var canp8 = document.getElementById("canp8");
canp8.width = 300;
canp8.height = 250;
canp8.style.top = "675px";
canp8.style.left = "400px";

var ctx8 = canp8.getContext("2d");


ctx8.fillStyle = "MidnightBlue";
ctx8.fillRect(0,0,canp8.width, canp8.height);
drawc(10,10,8,"green",ctx8);
/*
canp8.addEventListener("mousemove", mouseMove8, {passive:true});
canp8.addEventListener("mouseout", mouseOut8, {passive:true});
canp8.addEventListener("click", mouseClick8, {passive:true});
*/
// ********************************************************

var canp9 = document.getElementById("canp9");
canp9.width = 300;
canp9.height = 250;
canp9.style.top = "675px";
canp9.style.left = "700px";

var ctx9 = canp9.getContext("2d");


ctx9.fillStyle = "MidnightBlue";
ctx9.fillRect(0,0,canp9.width, canp9.height);
drawc(10,10,8,"green",ctx9);
/*
canp9.addEventListener("mousemove", mouseMove9, {passive:true});
canp9.addEventListener("mouseout", mouseOut9, {passive:true});
canp9.addEventListener("click", mouseClick9, {passive:true});
*/





// ***************************************************************************

function mouseMove1(){
  document.getElementById("canp1").style.border = "thick solid yellow";
}
function mouseOut1 () {
  document.getElementById("canp1").style.border = "thin  solid blue";
}
function mouseClick1 () {
//
}

// ******************************************** mouse 2 ********************

function mouseMove2(){
  document.getElementById("canp2").style.border = "thick solid yellow";
}
function mouseOut2 () {
  document.getElementById("canp2").style.border = "thin  solid blue";
}

var vid2;
function mouseClick2 () {
  vid2 = document.getElementById("myVideo2");
  vid2.loop = true;
  vid2.play();
}
function playVid2() {
  vid2 = document.getElementById("myVideo2");
  vid2.play();
}
function pauseVid2() {
  vid2.pause();
}

function mouseMove3(){
  document.getElementById("canp3").style.border = "thick solid yellow";
}
function mouseOut3 () {
  document.getElementById("canp3").style.border = "thin  solid blue";
}
function mouseClick3 () {
//
}

function mouseMove4(){
  document.getElementById("canp4").style.border = "thick solid yellow";
}
function mouseOut4 () {
  document.getElementById("canp4").style.border = "thin  solid blue";
}

var vid4;
function mouseClick4 () {
  vid4 = document.getElementById("myVideo4");
  vid4.loop = true;
  vid4.play();
}

function playVid4() {
  vid4 = document.getElementById("myVideo4");
  vid4.play();
}
function pauseVid4() {
  vid4.pause();
}

function mouseMove5(){
  document.getElementById("canp5").style.border = "thick solid yellow";
}
function mouseOut5 () {
  document.getElementById("canp5").style.border = "thin  solid blue";
}
function mouseClick5 () {
//
}

function mouseMove6(){
  document.getElementById("canp6").style.border = "thick solid yellow";
}
function mouseOut6 () {
  document.getElementById("canp6").style.border = "thin  solid blue";
}
function mouseClick6 () {
//
}

function mouseMove7(){
  document.getElementById("canp7").style.border = "thick solid yellow";
}
function mouseOut7 () {
  document.getElementById("canp7").style.border = "thin  solid blue";
}
function mouseClick7 () {
//
}

function mouseMove8(){
  document.getElementById("canp8").style.border = "thick solid yellow";
}
function mouseOut8 () {
  document.getElementById("canp8").style.border = "thin  solid blue";
}
function mouseClick8 () {
//
}

function mouseMove9(){
  document.getElementById("canp9").style.border = "thick solid yellow";
}
function mouseOut9 () {
  document.getElementById("canp9").style.border = "thin  solid blue";
}
function mouseClick9 () {
//
}


// ************************************ CREATE CANVAS PANES *******************************************

var winP = [];

function CreateWinP() {
  this.ctx;
  this.canp;
}

for (i=1;i<10;i++){
  winP[i] = new CreateWinP;
}

winP[1].ctx = ctx1;
winP[1].canp = canp1;
winP[2].ctx = ctx2;
winP[2].canp = canp2;
winP[3].ctx = ctx3;
winP[3].canp = canp3;
winP[4].ctx = ctx4;
winP[4].canp = canp4;
winP[5].ctx = ctx5;
winP[5].canp = canp5;
winP[6].ctx = ctx6;
winP[6].canp = canp6;
winP[7].ctx = ctx7;
winP[7].canp = canp7;
winP[8].ctx = ctx8;
winP[8].canp = canp8;
winP[9].ctx = ctx9;
winP[9].canp = canp9;

// *************************** the following are mouse click functions but of course can be called elsewhere *****

function selPane1() {
  alert("Pane 1");
  document.getElementById("pane1").innerHTML = "Hello World";
}

function selPane2() {
  alert("Pane 2");
  alert("making them all disappear except canvas");
  document.getElementById("windowpane").style.display = "none";
  document.getElementById("fields").style.display = "none";

}

function selPane3() {
  alert("Pane 3");
}

function selPane4() {
  alert("Pane 4");
  document.getElementById("pane4").innerHTML = "Hello World 4";
}

function selPane5() {
  alert("Pane 5");
}

function selPane6() {
  alert("Pane 6");
    document.getElementById("pane6").innerHTML = U[6].name;
//    document.getElementById("pane6").style.border = "thick solid yellow";
    document.getElementById("canp6").style.border = "thick solid yellow";

}

function selPane7() {
  alert("Pane 7");
    document.getElementById("pane7").innerHTML = "Hello World 7";
}

function selPane8() {
  alert("Pane 8");
    document.getElementById("pane8").innerHTML = "Hello World 8";
}

function selPane9() {
  alert("Pane ");
    document.getElementById("pane9").innerHTML = U[9].name;
}





// ***************************************************** NAMES OF UNIVERSES **************************

var defN = [];
  defN[1] = "1 HOMEs";
  defN[2] = "2 Long Term Care Unit";
  defN[3] = "3 ";
  defN[4] = "4 ";
  defN[5] = "5 ";
  defN[6] = "6 ";
  defN[7] = "7 ";
  defN[8] = "8 ";
  defN[9] = "9 ";

function loadMVnames(){
  var text = prompt("Enter names of the Universes as a list separated by commas. No quotes necessary.");
  parseMVnames(text);
}

function parseMVnames(x){
  let i,y,z;
  if (x == "" || x == null) return;
  for (i=1;i<10;i++){
    UN[i].name = "--";      //clear the decks
  }
  for (i=1; i<10; i++){
    y = x.indexOf(",",0);
    if (y== -1) break;
    UN[i].name = (x.substring(0,y));
    x = x.substring(y+1);
  }
  UN[i].name = x.substring(0);
  showMVname();
}

function showMVname() {
  document.getElementById("pane1").innerHTML = UN[1].name.fontcolor("white");
  document.getElementById("pane2").innerHTML = UN[2].name.fontcolor("white");
  document.getElementById("pane3").innerHTML = UN[3].name.fontcolor("white");
  document.getElementById("pane4").innerHTML = UN[4].name.fontcolor("white");
  document.getElementById("pane5").innerHTML = UN[5].name.fontcolor("white");
  document.getElementById("pane6").innerHTML = UN[6].name.fontcolor("white");
  document.getElementById("pane7").innerHTML = UN[7].name.fontcolor("white");
  document.getElementById("pane8").innerHTML = UN[8].name.fontcolor("white");
  document.getElementById("pane9").innerHTML = UN[9].name.fontcolor("white");
}

function rBlues(){
  let ranB, id, univ;
  var txt = prompt("Enter number of random conversion to Infected State");
  document.getElementById("rBlueNum").innerHTML = txt;
  if (txt == ""|| txt == undefined) return;
  ranB = parseInt(txt);
  for (i=0;i<ranB;i++){
    id = Math.floor(Math.random()*M.PCt);
    if (P[id].u != -1){
        univ = P[id].u;
        U[univ].blueCt++;
        U[univ].greenCt--;
    }
    P[id].state = "blue";
    P[id].clr = "blue";
    P[id].infectStart = cD;
    P[id].size = P[id].size;        // may change for BLUEs later
  }
}


// ************************************* CREATE MATRIX FOR MUTIVERSE ************************

function SetUpUniverse(){
  this.name;
}
function CreateMatrixRow() {
  this.name;
  this.row = [];
  this.probability = [];
}

var UN = [];

for (i=1; i<10; i++){
  UN[i] = new SetUpUniverse();
  UN[i].name = defN[i];
}

var Mx = [];

for (i=1; i<10; i++) {
  Mx[i] = new CreateMatrixRow;
  Mx[i].name = UN[i].name;        // probably not needed
}

document.getElementById("row1").innerHTML = UN[1].name;
document.getElementById("row2").innerHTML = UN[2].name;
document.getElementById("row3").innerHTML = UN[3].name;
document.getElementById("row4").innerHTML = UN[4].name;
document.getElementById("row5").innerHTML = UN[5].name;
document.getElementById("row6").innerHTML = UN[6].name;
document.getElementById("row7").innerHTML = UN[7].name;
document.getElementById("row8").innerHTML = UN[8].name;
document.getElementById("row9").innerHTML = UN[9].name;

showMVname();



// *************************************** DISPLAY MATRIX AND PROBABILITY DIStrIButioNS ******************



var MVtoggle = false;

function hideMV(){
  if (MVtoggle){
    showMV();
    MVtoggle = false;
  } else {
    MVtoggle = true;
    document.getElementById("myTab").style.display = "block";
    document.getElementById("chartContainer6").style.display = "block";
    document.getElementById("gameCanvas").style.display = "block";
    document.getElementById("localCharts").style.display = "block";
    document.getElementById("MVcharts").style.display = "none";
    document.getElementById("dayhr").style.display = "none";
    document.getElementById("windowpane").style.display = "none";
    document.getElementById("fields").style.display = "none";
    document.getElementById("MVmatrix").style.display = "none";
    document.getElementById("MV-menu").style.display = "none";
    VIEW = "local";
  }
}

function showMV(){
  document.getElementById("myTab").style.display = "none";
  document.getElementById("chartContainer6").style.display = "none";
  document.getElementById("gameCanvas").style.display = "none";
  document.getElementById("localCharts").style.display = "none";
  document.getElementById("MVcharts").style.display = "block";
  document.getElementById("dayhr").style.display = "block";
  document.getElementById("windowpane").style.display = "block";
  document.getElementById("fields").style.display = "block";
  document.getElementById("MVmatrix").style.display = "none";         //for now
  document.getElementById("MV-menu").style.display = "block";
  VIEW = "MV"

}


/* &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

                  THESE ARE THE CHARTS AND OBJECTS UNIVERSE

   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

*/


var M = new ConstructMVC;
var U = [];                   // local Universes
var P = [];                   // all people in the system
var T = [];                   // one ticket per person - 24hr or 1 week?
var D = [];
var H = [];                   // timer-based schedule of events - arr depart

var toTime = 0;
var toDD = 0;
var toHH = 0;


var cD = 0;       // not sure if we will use as globals
var xD = 0;       // proxy for repeated days
var cH = 0;       // initialization of 5AM
var cP = 0;
var cT = 0;       // for combined time DD*100+HR
var cS = 0;         // current stop
var pID = 0;

var vU = 0;   // visible U
var wU = 0;   // working U

var gen = 0;

function ConstructMVC() {
      this.UCt;                       // count of Universes
      this.PCt;
      this.GreenCt;                   // these are totals of all universes at this time
      this.YellowCt;
      this.BlueCt;
      this.RedCt;
      this.OrangeCt;                  // total count of population
      this.Cases
      this.clockDay;                  // the Master Clock Day
      this.clockHr;                 // the Master Clock clock hour
      this.logGreen = [];
      this.logYellow = [];
      this.logBlue = [];
      this.logRed = [];
      this.logOrange = [];
      this.logCases = [];
      this.endGreen = [];
      this.endYellow = [];
      this.endBlue = [];
      this.endRed = [];
      this.endOrange = [];
      this.endRedDelta = [];
      this.endCases = [];
      this.endVelocity = [];
}

const LTC = 1;
const HOME = 0;

M.UCt = 2;
M.PCt = 100;

M.GreenCt = M.PCt;      // these are totalled from U's
M.YellowCt = 0;
M.BlueCt = 0;
M.RedCt = 0;
M.OrangeCt = 0;
M.clockDay = 0;
M.clockHr = 0;

// ************************  this describes a local universe *********************************************************



function CreateUniverse() {
      this.uID;
      this.name;          // universe name
      this.population;    // universe current population
      this.Resident;    // these population numbers will change every hour perhaps
      this.Attached;
      this.Transient;
      this.minglX;
      this.greenCt;       // these counts reflect the status of this universe at this time
      this.yellowCt;
      this.blueCt;
      this.redCt;
      this.orangeCt;
      this.cases;
      this.canvas;
      this.arr;
      this.dep;
      this.day;
      this.hour;
      this.person = [];
      this.logGreen = [];
      this.logYellow = [];
      this.logBlue = [];
      this.logRed = [];
      this.logOrange = [];
      this.logCases = [];
      this.endGreen = [];
      this.endYellow = [];
      this.endBlue = [];
      this.endRed = [];
      this.endOrange = [];
      this.endCases = [];
      this.endRedDelta = [];                // we need this to point to the persons there - just pIDs
      this.endVelocity = [];
}

function initUniv(U,i){
      U.uID = i;
      U.name = "U"+i;
      U.population = 0;;
      U.Resident = 0;
      U.Attached = 0;
      U.Transient = 0;
      U.minglx = 0;
      U.greenCt = 0;
      U.yellowCt = 0;
      U.blueCt = 0;
      U.redCt = 0;
      U.orangeCt = 0;
      U.cases = 0;
      U.canvas = "";
      clearFlow(U);
      U.day = 0;
      U.hour = 0;
      U.person = [];
};

(function() {
  let i;
  for (i=0; i<9; i++) {
    U[i] = new CreateUniverse();
    U[i].arr = new CreateFlowStats();
    U[i].dep = new CreateFlowStats();
    initUniv(U[i],i);
  }
})();

function CreateFlowStats(){
  this.gCt = 0;
  this.yCt = 0;
  this.bCt = 0;
  this.rCt = 0;
  this.oCt = 0;
  this.resCt = 0;
  this.attCt = 0;
  this.visCt = 0;
}

function clearFlow(Q){
  Q.arr.gCt = 0;
  Q.arr.yCt = 0;
  Q.arr.bCt = 0;
  Q.arr.rCt = 0;
  Q.arr.oCt = 0;
  Q.arr.resCt = 0;
  Q.arr.attCt = 0;
  Q.arr.visCt = 0;

  Q.dep.gCt = 0;
  Q.dep.yCt = 0;
  Q.dep.bCt = 0;
  Q.dep.rCt = 0;
  Q.dep.oCt = 0;
  Q.dep.resCt = 0;
  Q.dep.attCt = 0;
  Q.dep.visCt = 0;
}

// *************************** CREATE PERSON PROTOTYPES *************************************************
//
//
var metState = "green";       // uninfected
var metIncStart = 0;
var metIncDays = 0;
var metIncMax = 2;
var metInfectSt = 0;
var metInfectDays = 0;
var metInfectMax = 4;
var metInfectMode = 0;
var metInfectRate = 0.2;
var metDiagStart = 0;
var metDiagDays = 0;
var metDiagMax = 1;
var metInertStart = 0;
var metInertDays = 0;
var radius = 5;


function CreatePerson() {       // the persistent info for a person
    this.pID;                   // issued in multiverse - most of this data generated in MULTIVERSE
    this.state;                 // uninfected; incubating; infectious; disagnosed; inert
    this.age;
    this.suscIndx;
    this.viralLoad;
    this.clr;
    this.incStart;              // date of infection and transition to incubating
    this.incDays;
    this.incMax;
    this.infectStart;           // date of transition to infectious
    this.infectDays;
    this.infectMax;
    this.infectMode;
    this.infectRate;
    this.diagStart;             // date of transition from asymtpomatic to diagnosed
    this.diagDays;
    this.diagMax;
    this.inertStart;            // date of transition to INERT
    this.inertDays;             // days since becoming inert

/* %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

                                LOCAL PERSON DATA STARTS here

   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
*/

    this.hour;                  // strictly local information
    this.day;
//    this.stopCt;            // these in Ticket already?
//    this.stop = [];
    this.u;
    this.role;
    this.ETA;
    this.ETD;
    this.size;
    this.minglx;
    this.X;
    this.Y;
    this.OldX;
    this.OldY;
    this.newX;
    this.newY;
    this.delX;
    this.delY;
    this.ddx;
    this.ddy;
}

(function() {
  let i;
  for (i=0; i<M.PCt; i++){
      P[i] = new CreatePerson;
      initPerson(P[i],i);
  }
})();


function initPerson(P,i){
    P.pID = i;
    P.state = metState;
    P.clr = "green";
    P.suscIndex = 1;
    P.viralLoad = 0;
    P.incStart = metIncStart;
    P.incDays = metIncDays;
    P.incMax = metIncMax;
    P.infectStart = metInfectSt;
    P.infectDays = metInfectDays;
    P.infectMax = metInfectMax;
    P.infectMode = metInfectMode;
    P.infectRate = metInfectRate;
    P.diagStart  = metDiagStart;
    P.diagDays = metDiagDays;
    P.diagMax = metDiagMax;
    P.inertStart = metInertStart;
    P.inertDays = metInertDays;

    P.day = 0;
    P.hour = 0;
    P.stopCt = 0;
    P.stop = [];
    P.u = -1;
    P.role = "R";
    P.ETA = 0;
    P.ETD = 0;
    P.size = 6;
    P.minglx = 2;
    P.X = 0;
    P.Y = 0;
    P.old = 0;
    P.old = 0;
    P.newX = 0;
    P.newY = 0;
    P.delX = 0;
    P.delY = 0;
    P.ddx = 0;
    P.ddy = 0;
}


// %%%%%%%%%%%%%%%%%%%%%%%%% NOW SET UP ALL THE LOCAL INFO BEFORE SPECIALIZING $$$$$$$$$$$$$$$$$$$$$$
//





// ******************************************************************************************************
//
//                              CREATE SCHEDULE AND TICKET POINTERS TO PERSONS BY HOUR
//
// ******************************************************************************************************
//


(function() {
  let i;
  for (i=0; i<M.PCt; i++){
    T[i] = new CreateTicket();
    T[i].pID = i;
    T[i].S = [];
  }
})();

function CreateTicket() {
  this.pID;
  this.S = [];
}

function CreateStop() {
  this.uHere;
  this.ETA;
  this.uDest;
  this.ETD;
  this.R;          // RESIDENT, ATTACHED, TRANSIENT
  this.M;          // deegree of mingling 0 to 10 - loner to pollster
}

function CreateTransfer(){
  this.pID;
  this.stopno;
  this.ETA;
  this.AU;
  this.ETD;
  this.TU;
  this.role;
  this.Mx;
}

var transfer = new CreateTransfer();

function CreateD(){
  this.DD;
  this.H = [];
}

function CreateH(){
  this.HH;
  this.u;
  this.cID;
  this.cS;
  this.cDir;
}


function parseL(lineStr){
  let lineS = lineStr;
  if (lineS == "") return false;
  transfer.pID = lineS[0];
  transfer.stopno = eval(lineS[1]);
  transfer.ETA = eval(lineS[2]);
  transfer.AU = eval(lineS[3]);
  transfer.ETD = eval(lineS[4]);
  transfer.TU = eval(lineS[5]);
  transfer.role = lineS[6];
  transfer.Mx = eval(lineS[7]);
  return true;
}

function setupTicket(){
      let tr = transfer;
      let Tx;
      let sno;

      Tx = new CreateStop;
      if (tr.pID == pID || tr.pID == "") {
          Tx.pID = pID;
      } else {
          Tx.pID = tr.pID;
          pID = tr.pID;                  // break - new playVid2
      }
      Tx.uHere = tr.AU;
      Tx.ETA = tr.ETA;
      Tx.uDest = tr.TU;
      if (tr.AU == tr.TU) {
        Tx.ETD = -1
      } else {
        Tx.ETD = tr.ETD;
      }
      Tx.R = tr.role;
      Tx.M = tr.Mx;
      sno = tr.stopno;
      T[pID].S[sno] = Tx;

      let t,d,h;
      let X;

      t = Tx.ETA;
      d = Math.floor(t/100);
      h = t%100;
      if (D[d]===undefined || D[d]==null){
          D[d] = new CreateD();
      }
      D[d].DD = d;
        X = new CreateH();
        X.HH = h;
        X.u = Tx.uHere;
        X.cID = pID;
        X.cS = sno;
        X.cDir = "A";
      if (D[d].H[h] === undefined || D[d].H[h] == "")
          D[d].H[h] = [];
      D[d].H[h].push(X);

      if (tr.AU == tr.TU) return;

      t = Tx.ETD;
      d = Math.floor(t/100);
      h = t%100;
      if (D[d]===undefined || D[d]==null){
          D[d] = new CreateD();
      }
      D[d].DD = d;
        X = new CreateH();
        X.HH = h;
        X.u = Tx.uHere;
        X.cID = pID;
        X.cS = sno;
        X.cDir = "D";
        if (D[d].H[h] === undefined || D[d].H[h] == "")
            D[d].H[h] = [];
      D[d].H[h].push(X);
}

function processLines(){
    let i,j;
    if (lines[0][0] == "pID") lines.shift();
    var lineNo = lines.length;
    for (i=0;i<lineNo;i++){
      if (parseL(lines[i]))
          setupTicket();
    }
    document.getElementById("getFile").style.display="none";
}



// **************************** start at 0600 end at 2200 *************************************


const FPS = 30;
const MOTION = 5000;

var canWidth = 800;
var canHeight = 600;
var bs = 12;    //ball size
var bx = [];      //presumably ball center
var by = [];
var xv = [];    //velocity in x and y directions
var yv = [];
var bColor = [];

var canvas, ctx;

// load canvas
canvas = document.getElementById("gameCanvas");
ctx = canvas.getContext("2d");
ctx.fillStyle = "black";
ctx.fillRect(0,0,canvas.width, canvas.height);
ctx.globalCompositeOperation = "source-over";

// set up interval (game loop)
//  setInterval(update,500/FPS);     //update every 1/30th sec

var travel = [1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,7,8,9,10,30,40,50];
var dIRECTION = [-1,0,1];
var rand, randint;

//hideMV();

function Epicenter(){
    this.X;
    this.Y;
    this.perim;
}

var epic1 = new Epicenter;
  epic1.X = canWidth/4;
  epic1.Y = canHeight/4;
  epic1.perim = 30;
var epic2 = new Epicenter;
  epic2.X = canWidth/4;
  epic2.Y = canHeight/4*3;
  epic2.perim = 30;
var epic3 = new Epicenter;
  epic3.X = canWidth/4*3;
  epic3.Y = canHeight/4;
  epic3.perim =30;
var epic4 = new Epicenter;;
  epic4.X = canWidth/4*3;
  epic4.Y = canHeight/4*3;
  epic4.perim = 30;
var epic5 = new Epicenter;
  epic5.X = canWidth/2;
  epic5.Y = canHeight/2;
  epic5.perim = 30;


var perim = 20;

epic1.X = epic3.X;
epic2.X = epic3.X;
epic4.X = epic3.X;
epic5.X = epic3.X;
epic1.Y = epic3.Y;
epic2.Y = epic3.Y;
epic4.Y = epic3.Y;
epic5.Y = epic3.Y;
epic1.perim = perim;
epic2.perim = perim;
epic3.perim = perim;
epic4.perim = perim;
epic5.perim = perim;






async function canvTxt(x,y,day,hr,u){
  ctx.font = "30px Arial";
  ctx.fillStyle = "white";
  ctx.fillText("Day"+day+"   HR:"+hr+"  U"+u,x,y);
}

async function drawC(x,y,rad,color){
    ctx.beginPath();
    ctx.arc(x,y,rad,0,2*Math.PI);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.stroke();
    ctx.strokeStyle = "black";
}

async function drawCross(x,y,width,height,clr){
    ctx.beginPath();
    ctx.moveTo(x,y);
    ctx.fillStyle = clr;
    ctx.fillRect(x,y,width,height);
    ctx.fillRect(Math.round(x+width/2-height/2),Math.round(y+height/2-width/2),height,width);
}

async function drawRect(x,y,width,height,clr){
    ctx.beginPath();
    ctx.moveTo(x,y);
    ctx.fillStyle = clr;
    ctx.fillRect(x,y,width,height);
}

async function drawEpi(){
    drawCross(epic1.X, epic1.Y, 5,1,"pink");
    drawCross(epic2.X, epic2.Y, 5,1,"pink");
    drawCross(epic3.X, epic3.Y, 5,1,"pink");
    drawCross(epic4.X, epic4.Y, 5,1,"pink");
    drawCross(epic5.X, epic5.Y, 5,1,"pink");
    canvTxt(15,30,cD,cH,vU);
}

// &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//
//          these functions deal with parameter settings by user incl slider
//
// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function showIncD(){
  let incTxt = prompt("Current incubation days as shown below. Enter new value if desired, otherwise cancel", metIncMax);
  let incDays = parseInt(incTxt);
  document.getElementById("dIncD").innerHTML = incDays;
  if (incDays === null || incDays == "" || incDays == metIncMax) return;
  metIncMax = incDays;
}

function showInfD(){
  let infTxt = prompt("Current asymptomatic transmission days shown below. To change, enter new value else cancel", metInfectMax);
  let infDays = parseInt(infTxt);
  document.getElementById("dInfD").innerHTML = infDays;
  if (infDays === null || infDays == "" || infDays == metInfectMax) return;
  metInfectMax = infDays;
}

function showCliD(){
  let cliTxt = prompt("Current days of infectivity after case is symptomatic or tested positive \nTo\
 change enter new value or cancel (applies to REDs)", metDiagMax);
  let cliDays = parseInt(cliTxt);
  document.getElementById("dCliD").innerHTML = cliDays;
  if (cliDays === null || cliDays == "" || cliDays == metDiagMax) return;
  metDiagMax = cliDays;
}

function showCycle(){
  let infTxt = prompt("Current activity events per hour. To change, enter new value else cancel", cycleMax);
  let infCyc = parseInt(infTxt);
  document.getElementById("dCycl").innerHTML = infCyc;
  if (infCyc === null || infCyc == "" || infCyc == cycleMax) return;
  cycleMax = infCyc;
}

function showPradius(){
  let rTxt = prompt("Enter Hazard rtadius of personal safety \nThe smaller the extent of isolation", radius);
  let pRad = parseInt(rTxt);
  document.getElementById("dPrad").innerHTML = pRad;
  if (pRad === null || pRad == "" || pRad == radius) return;
  radius = pRad;
};
/*
  for (i=1; i<Population+1; i++){
    if (pStatus[i]=="orange"){
      pSize[i]=6;
    } else {
    pRatio = parseFloat(radius/pOldSz[i]);
    pSize[i]=radius + pRatio;     //the new size plus a bit
    }
*/

function getToTime(){
  let toTxt = prompt("Enter the DDHH time that this program is to run until", cycleMax);
  let toHHDD = parseInt(toTxt);
  document.getElementById("toHHDD").innerHTML = toHHDD;
  if (toHHDD === null || toHHDD == "" || toHHDD == toTime) return;
  toTime = toHHDD;
}


async function injectXY(G,g,stop){
    let present;

//  update Person - Universe - Multiverse
//  BUT IF THE PERSON IS ALREADY THERE WE DO NOT ADD, SO WE HAVE TO
//  TEST LOCAL POPULATION AGAINST THE PERSON P

    G.day = cD;
    G.hour = cH;
    G.role = T[g].S[stop].R;
    G.ETA = T[g].S[stop].ETA;
    G.ETD = T[g].S[stop].ETD;
    G.minglx = T[g].S[stop].M;
    G.u = wU;
    G.size = sizeP(G,g);
    U[wU].day = cD;
    U[wU].hour = cH;

    present = U[wU].person.includes(g);
    if (present) return;

    G.X= Math.floor(Math.random()*canWidth);
    G.Y = Math.floor(Math.random()*canHeight);
    G.newX = G.X;
    G.newY = G.Y;

    U[wU].population++;
    switch (G.role){
      case "R":
          U[wU].Resident++;
          U[wU].arr.resCt++
          break;
      case "A":
          U[wU].Attached++;
          U[wU].arr.attCt++;
          break;
      case "T":
          U[wU].Transient++;
          U[wU].arr.visCt++;
          break;
    }

    switch (G.state){
      case "green":
          U[wU].greenCt++;
          U[wU].arr.gCt++;
          break;
      case "yellow":
          U[wU].yellowCt++;
          U[wU].arr.yCt++;
          break;
      case "blue":
          U[wU].blueCt++;
          U[wU].arr.bCt++;
          break;
      case "red":
          U[wU].redCt++;
          U[vU].arr.rCt++;
          U[wU].cases++;
          break;
      case "orange":
          U[wU].orangeCt++;
          U[vU].arr.oCt++;
          U[wU].cases++;
          break;
    }

    U[wU].person.push(g);
    if (wU == vU && VIEW=="local") await drawAgent(G.X,G.Y,g,"white");
}

function sizeP(G,g){
  return(G.size);
}

async function drawAgent(x,y,g,clrFlag){

    fullCt++;
    let clr, size;
    size  = P[g].size;
//    canvTxt(15,30,cD,cH,vU);
    if (clrFlag == -1){
      clr = P[g].state;
    } else clr = clrFlag;
    switch (P[g].role){
      case "R":
        await drawC(x,y,size,clr);
        break;
      case "A":
        await drawCross(x,y,2*size,size/2,clr);
        break;
      case "T":
        await drawRect(x,y,1.5*size,1.5*size,clr);
    }
}

async function drawU(){
    let i,j,k, l;
    await drawRect(0,0,canWidth,canHeight,"black");
    canvTxt(15,30,cD,cH,vU);
    k = U[vU].person.slice(0);
    l = k.length;
    for (i=0;i<l;i++){
        j = k.pop();
        drawAgent(P[j].X,P[j].Y,j,-1);
    }
    upDateGraph(U[vU],vU);
}


var delX, delY;
function proposeMove(G,g){
    rand = Math.floor(Math.random()*43);
    G.delX = travel[rand]*G.size/2;
    rand = Math.floor(Math.random()*43);
    G.delY = travel[rand]*G.size/2;

    if (G.state == "blue") {
      G.delX = G.delX * G.minglx;
      G.delY = G.delY * G.minglx;
    }

    if (Math.floor(Math.random() * 2) == 0){
      G.delX = -G.delX;
    }
    if (Math.floor(Math.random() * 2) == 0){
      G.delY = -G.delY;
    }
    G.newX = G.X + G.delX;
    G.newY = G.Y + G.delY;

    testWall(G,g);
}


function testWall(G,g){
    if (G.newX - G.size/2 <0 && G.delX<0){
      G.delX = -G.delX;
    }
    if (G.newX + G.size/2 > canWidth && G.delX>0){
      G.delX = -G.delX;
    }
    if (G.newY - G.size/2 <0 && G.delY<0){
      G.delY = -G.delY;
    }
    if (G.newY + G.size/2 > canHeight && G.delY>0){
      G.delY = -G.delY;
    }

    G.newX = G.X + G.delX;
    G.newY = G.Y + G.delY;
}

function nearestEpicenter(x,y){
    let dist1, dist2, dist3, dist4, win1, win2, winner1, winner2;
    dist1 = Math.floor((x-epic1.X)**2 + (y-epic1.Y)**2);
    dist2 = Math.floor((x-epic2.X)**2 + (y-epic2.Y)**2);
    dist3 = Math.floor((x-epic3.X)**2 + (y-epic3.Y)**2);
    dist4 = Math.floor((x-epic4.X)**2 + (y-epic4.Y)**2);
    dist5 = Math.floor((x-epic5.X)**2 + (y-epic5.Y)**2);


    if (dist2 > dist1) {
      win1 = dist1;
      winner1 = epic1;
    } else {
      win1 = dist2;
      winner1 = epic2;
    }

    if (dist4 > dist3){
      win2 = dist3;
      winner2 = epic3;
    } else {
      win2 = dist4;
      winner2 = epic4;
    }

    if (win2 > win1){
      if (win1>dist5){
        return(epic5)
      } else return(winner1)
    } else {
      if (win2>dist5){
        return(epic5)
      } else return(winner2);
    }
}

function adjMinglx(G,g,epic){
    let delX, delY;
    G.delX = Math.abs(Math.floor((G.newX - epic.X)/G.minglx));
    G.delY = Math.abs(Math.floor((G.newY - epic.Y)/G.minglx));

/*
if (P[indx].state == "blue"){
  if (delX <100) G.delX = -G.delX;
  if (delY <100) G.delY = -G.delY;
}
*/


if (G.newX > epic.X){
  G.newX = Math.max((epic.X+epic.perim),G.newX-G.delX)
} else {
  G.newX = Math.min((epic.X-epic.perim),G.newX+G.delX);
}
if (G.newY > epic.Y){
  G.newY = Math.max((epic.Y+epic.perim),G.newY-G.delY)
} else {
  G.newY = Math.min((epic.Y-epic.perim),G.newY+G.delY);
}

G.newX = G.newX + Math.floor(Math.random()*15);      // avoid strict duplicate positions
G.newY = G.newY + Math.floor(Math.random()*15);
}

/*
for (i=0;i<20;i++){
  injectXY(P[i],i);
}
*/


function findOverlap(G,g,Q,q){
  let i,j;
  let elect, univ;
  let k;
  let len;

  k = Q.person;
  len = k.length;

  for (i=0;i<len;i++){
      if (g==k[i] && i==len) break;
      if (g==k[i]) continue;
      j = overlapTest(g,k[i]);
      if (j == -1) continue;
      elect = testPairing(g,k[i]);
      if (elect == -1) continue;

      univ = P[elect].u;
      U[univ].yellowCt++;
      U[univ].greenCt--;

      P[elect].state = "yellow";
      P[elect].incStart = cD;
      P[elect].incDays = 0;
      P[elect].clr = "yellow";
      if (univ==vU && VIEW=="local") drawAgent(P[elect].newX,P[elect].newY,j,-1);
      if (univ==vU && VIEW=="local") showUstat(U[univ],univ);
}

function overlapTest(pID,rID){
  let inter1, inter2, inter3, inter4;
      inter1 = Math.pow((P[pID].X-P[rID].newX),2);
      inter2 = Math.pow((P[pID].Y-P[rID].newY),2);
      inter3 = inter1 + inter2;
      inter4 = Math.sqrt(inter3);
      if (inter4 < (P[pID].size+P[rID].size)) {
            return pID
      } else { return -1 };
}

function testPairing(pID,rID){
  let indxS, popnS;
  let clrFlag;

      indxS = P[pID].state;
      popnS = P[rID].state;
      clrFlag = false;

      if ((indxS == "green") &&
          (popnS == "blue" || popnS == "red")) {
          clrFlag = true
      } else {
        if ((popnS == "green") &&
            (indxS == "blue" || indxS == "red")) {
            clrFlag = true;
        }
      }
      if (!clrFlag) {return -1};
      if (indxS == "green") {
          return pID;
      } else return rID;
}

}


var epic;


async function startIt(){
    let i,j,k,n,len;
    let Q;

    cycleCount++;
    document.getElementById("dCycl").innerHTML = cycleCount;
    if (cycleCount >= cycleMax){
      cycleCount = 0;
      if (wU==vU && VIEW=="local") await drawU();
      if (wU==vU && VIEW=="local") showUstat(U[wU],wU);
      return;
    }
    if (wU==vU && VIEW=="local") await drawRect(0,0,canWidth,canHeight,"black");
    if (wU==vU && VIEW=="local") await drawEpi();
    Q = U[wU];
    k = Q.person;
    len = k.length;
    for (i=0;i<len;i++){
        j = k[i];
        proposeMove(P[j],j);
        epic = nearestEpicenter(P[j].newX,P[j].newY);

//        adjMinglx(P[j],j,epic);
        findOverlap(P[j],j,U[wU],wU);

        if (wU==vU && VIEW=="local") await drawAgent(P[j].X,P[j].Y,j,"black");
        P[j].X = P[j].newX;
        P[j].Y = P[j].newY;
        if (wU==vU && VIEW=="local") await drawAgent(P[j].newX,P[j].newY,j,-1);
        if(wU==vU && VIEW=="local") showUstat(U[wU],wU);
    }
    anFlag = true;
}


function clickButton(){
      aniCt++;
      document.querySelector("#popClick").click();
      mouseFlag = true;
      clickButton;
}




async function aniMate(){
  cycleCount = 0;
  if (anFlag){         // 30 cycles in an hour
        await startIt();
        anFlag = false;
      }
}


// ****************************   *********************
var anFlag = true;
var animClk;
var cycleCount = 0;
var nU = 0;

var iCycle;
var cycleMax = 30;
var arrFlag = false;
var depFlag = false;


cD = 0;
cH = 0;
chkMaxTime = 24;
drawEpi();

var conductorTimer;
var movieTimer;
var cycleTimer;
//hideMV();

function startClock(){
  M.clockHr = cH;
  M.clockDay = cD;
  vU = 0;
  wU = 0;
  gen = 0;
  conductorTimer = setInterval(conductor, 20);
}

async function advanceTime(){
    if (cH == chkMaxTime){
        alert("End of Day - go home, no more coding!");
        M.clockDay++;
        M.clockHr = 0;
        cD = M.clockDay;
        cH = 0;
        if (D[cD] == "" || D[cD] === undefined){
          true
        } else xD = cD;
    } else {
        M.clockHr++;
    }
    cS = 0;

    cH = M.clockHr;
    cT = ((cD*100+cH)/100);
    document.getElementById("day").innerHTML = ("DAY:\n"+cD);
    document.getElementById("hour").innerHTML = ("HOUR:\n"+cH);
    await drawRect(0,0,canWidth,canHeight,"black");
    await canvTxt(15,30,cD,cH,vU);
    await drawEpi();
}

async function conductor(){
    let slot, action;

    if (D[xD] === undefined || D[xD] == "" || D[xD].H[cH] === undefined || D[xD].H[cH]==""){
      await finishHour();
      return;
    }
    arrLength = D[xD].H[cH].length;
    if (cS == arrLength){         // end of stops
        await finishHour();
    } else {
        wU = D[xD].H[cH][cS].u;
        if (cS<arrLength){
            wU = D[xD].H[cH][cS].u;
            slot = D[xD].H[cH][cS].cS;          // the person's slot number
            action = D[xD].H[cH][cS].cDir;      // the direction
            pID = D[xD].H[cH][cS].cID;          // the person

            if (action == "A") injectXY(P[pID],pID,slot);
            if (action == "D") expel(P[pID],pID, slot);
        }
        cS++;
    }
}

function expel(G,g,slot){
  let Q, len;
  Q = U[wU];
  if (T[g].S[slot].ETD != -1){
    Q.population--;
    len = Q.person.length;
    let thisP = Q.person.indexOf(g);
    let A = Q.person.slice(0,thisP);
    let B = Q.person.slice(thisP+1,len);
    Q.person = A.concat(B);

    switch (G.role){
      case "R":
          Q.Resident--;
          Q.dep.resCt++;
          break;
      case "A":
          Q.Attached--;
          Q.dep.attCt++;
          break;
      case "T":
          Q.Transient--;
          Q.dep.visCt++;
          break;
    }

    switch (G.state){
      case "green":
          Q.greenCt--;
          Q.dep.gCt++;
          break;
      case "yellow":
          Q.yellowCt--;
          Q.dep.yCt++;
          break;
      case "blue":
          Q.blueCt--;
          Q.dep.bCt++;
          break;
      case "red":
          Q.redCt--;
          Q.dep.rCt++;
          Q.cases--;
          break;
      case "orange":
          Q.orangeCt--;
          Q.dep.oCt++;
          Q.cases--;
          break;
    }
  }
}


async function finishHour(){
  let i;
    clearInterval(conductorTimer);      //*** CRITICAL FOR CONTINUITY
    gen++;
    if (MODE=="auto") {
        for (i=0;i<M.UCt;i++){
          anFlag=true;
          wU=i;
          await aniMate();
          if (i==vU && VIEW=="local") await drawU();          // refresh the visible just in case
//          if (i==vU && VIEW=="local") showUstat(U[vU],vU);
        }
        stateChange();
        await tabulate();
        advanceTime();

    }
    if (VIEW=="local" && wU==vU) drawU();
}

async function nextHour(){
    clearInterval(conductorTimer);

    gen++;
    for (i=0;i<M.UCt;i++){
      clearFlow(U[i]);
      anFlag=true;
      wU=i;
      await aniMate();
      if (i==vU && VIEW=="local") drawU();          // refresh the visible just in case
//      if (i==vU && VIEW=="local") showUstat(U[vU],vU);
    }
    await stateChange();
    await tabulate();
    drawU();

    advanceTime();                 // of course this is for all U's
    conductorTimer = setInterval(conductor,2);
}

async function stateChange(){
  let i,j, G, Q;
  for (i=0;i<M.PCt;i++){
    if (P[i].u == -1) continue;      // not yet placed into U
    G = P[i];         // P[i] is the data array for the person
    Q = U[G.u];       // Q is now the data array for P's Universe
    switch(G.state) {
      case  "yellow":
          G.incDays++;
          if (G.incDays >= G.incMax){
              G.incDays = 0;
              G.state = "blue";
              G.infectStart = cD;
              G.infectDays = 0;
              G.infectMode = 0;
              G.infectRate = 1.0;
              Q.yellowCt--;
              Q.blueCt++;
          }
          break;
      case "blue":
          G.infectDays++;
          if (G.infectDays >= G.infectMax){
              G.infectDays = 0;
              G.state = "red";
              G.diagStart = cD;
              G.diagDays = 0;
              Q.blueCt--;
              Q.redCt++;
          }
            break;
      case "red":
          G.diagDays++;
          if (G.diagDays >= G.diagMax){
              G.diagDays = 0;
              G.inertStart = cD;
              G.inertDays = 0;
              G.state = "orange";
              Q.redCt--;
              Q.orangeCt++;
          }
          break;
      case "orange":
          G.inertDays++;
          break;

    }
  }
  sumUcount();
}

function showUstat(Q,q){
  if (VIEW == "local" && q==vU){
    document.getElementById("grCt").innerHTML = Q.greenCt;
    document.getElementById("yeCt").innerHTML = Q.yellowCt;
    document.getElementById("blCt").innerHTML = Q.blueCt;
    document.getElementById("reCt").innerHTML = Q.redCt;
    document.getElementById("orCt").innerHTML = Q.orangeCt;
  }
}

function sumUcount(){
  let i,j,Q;
  for (i=0; i<M.UCt;i++){
    M.GreenCt = 0;
    M.YellowCt = 0;
    M.BlueCt = 0;
    M.RedCt = 0;
    M.OrangeCt = 0;
    M.Cases = 0;
  }
  for (i=0; i<M.UCt;i++){
    Q = U[i];
    M.GreenCt = M.GreenCt + Q.greenCt;
    M.YellowCt = M.YellowCt + Q.yellowCt;
    M.BlueCt = M.BlueCt + Q.blueCt;
    M.RedCt = M.RedCt + Q.redCt;
    M.OrangeCt = M.OrangeCt + Q.orangeCt;
    M.Cases = M.RedCt+M.OrangeCt;
  }
  M.logGreen[gen] = M.GreenCt;
  M.logYellow[gen] = M.YellowCt;
  M.logBlue[gen] = M.BlueCt;
  M.logRed[gen] = M.RedCt;
  M.logOrange[gen] = M.OrangeCt;
  M.logCases[gen] = M.cases;
}

var lastU = -1;
var hU = 0;

async function showU(){
  let Q;
  let mu = vU;
      mu = (mu+1)%M.UCt;
      vU = mu;
      wU = mu;

      Q = U[vU];
      await drawU();
      showUstat(Q,vU);

      if (VIEW=="local" && gen>=0) {
          cleanCharts();
          await upDateGraph(Q,vU);
        }
}

function cleanCharts(){
    chart1.options.data[0].dataPoints = [];
    chart1.options.data[0].dataPoints = U[vU].endCases;

    chart2.options.data[0].dataPoints = [];
    chart2.options.data[0].dataPoints = U[vU].endRedDelta;

    chart3.options.data[0].dataPoints = [];
    chart3.options.data[0].dataPoints = U[vU].endVelocity;

    chart4.options.data[0].dataPoints = [];
    chart4.options.data[0].dataPoints = U[vU].endGreen;
    chart4.options.data[1].dataPoints = [];
    chart4.options.data[1].dataPoints = U[vU].endYellow;
    chart4.options.data[2].dataPoints = [];
    chart4.options.data[2].dataPoints = U[vU].endBlue;;
    chart4.options.data[3].dataPoints = [];
    chart4.options.data[3].dataPoints = U[vU].endRed;
    chart4.options.data[4].dataPoints = [];
    chart4.options.data[4].dataPoints = U[vU].endOrange;

    chart6.options.data[0].dataPoints = [];
    chart6.options.data[0].dataPoints = U[vU].endGreen;
    chart6.options.data[1].dataPoints = [];
    chart6.options.data[1].dataPoints = U[vU].endYellow;
    chart6.options.data[2].dataPoints = [];
    chart6.options.data[2].dataPoints = U[vU].endBlue;;
    chart6.options.data[3].dataPoints = [];
    chart6.options.data[3].dataPoints = U[vU].endRed;
    chart6.options.data[4].dataPoints = [];
    chart6.options.data[4].dataPoints = U[vU].endOrange;
}



async function tabulate(){
  let i;
  let Q;
  for (i=0;i<M.UCt;i++){
      Q = U[i];
      Q.logGreen[gen] = Q.greenCt
      Q.logYellow[gen] = Q.yellowCt
      Q.logBlue[gen] = Q.blueCt
      Q.logRed[gen] = Q.redCt
      Q.logOrange[gen] = Q.orangeCt
      Q.logCases[gen] = Q.casesCt;

      let vNum, vDenom, endV = 0;
      let len = 0;

      Q.endGreen.push({y:Q.logGreen[gen], x:gen});
      Q.endYellow.push({y:Q.logYellow[gen],x:gen});
      Q.endBlue.push({y:Q.logBlue[gen],x:gen});
      Q.endRed.push({y:Q.logRed[gen],x:gen});
      Q.endOrange.push({y:Q.logOrange[gen],x:gen});
      Q.endCases.push({y:Q.logCases[gen],x:gen});
      if (gen > 1){
        let del = Q.logCases[gen]-Q.logCases[gen-1];
        Q.endRedDelta.push({y:del,x:gen});
      } else
        Q.endRedDelta.push({y:0,x:gen});

      len = Q.endRedDelta.length;
      endV = 0;
      if (len>1){
          vNum = Q.endRedDelta[len-1].y;
          vDenom = Q.endCases[len-2].y;
          if (vDenom!=0){
              endV = parseFloat((vNum/vDenom)*100);
          }
      }
      Q.endVelocity.push({y:endV, label:len});
  }
  Mtabulate();
  await upDateGraph(Q,i);
}

function Mtabulate(){
    M.logGreen[gen] = M.GreenCt;
    M.logYellow[gen] = M.YellowCt;
    M.logBlue[gen] = M.BlueCt;
    M.logRed[gen] = M.RedCt;
    M.logOrange[gen] = M.OrangeCt;
        M.cases=M.RedCt+M.OrangeCt;
    M.logCases[gen] = M.CasesCt;

    let vNum, vDenom, endV = 0;
    let len = 0;

    M.endGreen.push({y:M.logGreen[gen], x:gen});
    M.endYellow.push({y:M.logYellow[gen],x:gen});
    M.endBlue.push({y:M.logBlue[gen],x:gen});
    M.endRed.push({y:M.logRed[gen],x:gen});
    M.endOrange.push({y:M.logOrange[gen],x:gen});
    M.endCases.push({y:M.logCases[gen],x:gen});

    if (gen > 1){
      let del = M.logCases[gen]-M.logCases[gen-1];
      M.endRedDelta.push({y:del,x:gen});
    } else
      M.endRedDelta.push({y:0,x:gen});

    len = M.endRedDelta.length;
    endV = 0;
    if (len>1){
        vNum = M.endRedDelta[len-1].y;
        vDenom = M.endCases[len-2].y;
        if (vDenom!=0){
            endV = parseFloat((vNum/vDenom)*100);
        }
    }
    M.endVelocity.push({y:endV, label:len});
}


async function upDateGraph(Q,q){

    if (VIEW=="local") {
        showUstat(Q,q);
        chart6.render();
        chart1.render();
        chart2.render();
        chart3.render();
        chart4.render();

        document.getElementById("popStat").innerHTML = Q.population;
        document.getElementById("arrStat").innerHTML = (Q.arr.resCt+Q.arr.attCt+Q.arr.visCt);
        document.getElementById("depStat").innerHTML = (Q.dep.resCt+Q.dep.attCt+Q.dep.visCt);



        document.getElementById("resCt").innerHTML = Q.Resident;
        document.getElementById("attCt").innerHTML = Q.Attached;
        document.getElementById("visCt").innerHTML = Q.Transient;

        document.getElementById("GArr").innerHTML = Q.arr.gCt;
        document.getElementById("YArr").innerHTML = Q.arr.yCt;
        document.getElementById("BArr").innerHTML = Q.arr.bCt;
        document.getElementById("RArr").innerHTML = Q.arr.rCt;
        document.getElementById("OArr").innerHTML = Q.arr.oCt;
        document.getElementById("ResArr").innerHTML = Q.arr.resCt;
        document.getElementById("AttArr").innerHTML = Q.arr.attCt;
        document.getElementById("VisArr").innerHTML = Q.arr.visCt;

        document.getElementById("GDep").innerHTML = Q.dep.gCt;
        document.getElementById("YDep").innerHTML = Q.dep.yCt;
        document.getElementById("BDep").innerHTML = Q.dep.bCt;
        document.getElementById("RDep").innerHTML = Q.dep.rCt;
        document.getElementById("ODep").innerHTML = Q.dep.oCt;
        document.getElementById("ResDep").innerHTML = Q.dep.resCt;
        document.getElementById("AttDep").innerHTML = Q.dep.attCt;
        document.getElementById("VisDep").innerHTML = Q.dep.visCt;
    }

    if (VIEW=="MV"){
        chart7.render();
        chart8.render();
        chart9.render();
        chart10.render();
        chart11.render();
        chart12.render();
        chart13.render();
        chart14.render();
        chart15.render();
        chart16.render();
        chart17.render();
        chart18.render();
        chart19.render();
        chart20.render();
    }
}

CanvasJS.addColorSet("Overview GYBRO",
   [
   "#008000",
   "#FFD700",
   "#1E90FF",
   "#FF0000",
   "#FF8C00",
  ]);

  var chart1 = new CanvasJS.Chart("chartContainer1", {
      	animationEnabled: true,
      	theme: "light2", // "light1", "light2", "dark1", "dark2"
      	title:{
      		text: "TOTAL Cases to Date"
  	},
  	axisY: {
  		title: "Number of Clinical or Positive"
  	},
    width:500,
  	data: [{
  		type: "column",
  		showInLegend: true,
  		legendMarkerColor: "grey",
  		legendText: "Days since beginning",
  		dataPoints: U[vU].endCases
  	}]
  });


// chart 2 **********************************************



  var chart2 = new CanvasJS.Chart("chartContainer2", {
    animationEnabled: true,
    theme: "light2", // "light1", "light2", "dark1", "dark2"
    title:{
      text: "Daily NEW Cases"
    },
    axisY: {
      title: "Number of Clinical or Positive"
    },
    width:500,
    data: [{
      type: "column",
      showInLegend: true,
      legendMarkerColor: "grey",
      legendText: "Days since beginning",
      dataPoints: U[vU].endRedDelta
  }]
  });


// CHART3 **********************************************************


  var chart3 = new CanvasJS.Chart("chartContainer3", {
  animationEnabled: true,
  zoomEnabled: true,
  theme: "light2", // "light1", "light2", "dark1", "dark2"
  title:{
    text: "Percent Increase over Previous TOTAL"
  },
  axisY: {
    title: "Percent Increase"
  },
  data: [{
    type: "line",
    showInLegend: true,
    legendMarkerColor: "grey",
    legendText: "Days since beginning",
    dataPoints: U[vU].endVelocity
  }]
  });


// *********************************************************************************
// CHART 4 - GREEN YELLOE BLUE RED over time



  var chart4 = new CanvasJS.Chart("chartContainer4", {
  //  theme: "light1",
    colorSet: "Overview GYBRO",
    title:{
      text: "Progress of Transitions"
    },
      data: [
    {
      type: "stackedColumn",
      dataPoints: U[vU].endGreen
    },  {
      type: "stackedColumn",
      dataPoints: U[vU].endYellow
    },  {
      type: "stackedColumn",
      dataPoints: U[vU].endBlue
    },  {
      type: "stackedColumn",
      dataPoints: U[vU].endRed
    },  {
      type: "stackedColumn",
      dataPoints: U[vU].endOrange
    }
      ]
    }
  );




CanvasJS.addColorSet("Overview GYBRO",
   [
   "#008000",
   "#FFD700",
   "#1E90FF",
   "#FF0000",
   "#FF8C00",
  ]);


var chart6 = new CanvasJS.Chart("chartContainer6",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "column",
  markerType: "none",
  dataPoints: U[vU].endGreen

},  {
  type: "column",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[vU].endYellow
},  {
  type: "column",
  markerType: "none",
  dataPoints: U[vU].endBlue
},  {
  type: "column",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[vU].endRed
},  {
  type: "column",
  markerType: "none",
  dataPoints: U[vU].endOrange
  }
  ]
}
);

var chart7 = new CanvasJS.Chart("chartContainer7",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "column",
  markerType: "none",
  dataPoints: U[0].endGreen

},  {
  type: "column",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[0].endYellow
},  {
  type: "column",
  markerType: "none",
  dataPoints: U[0].endBlue
},  {
  type: "column",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[0].endRed
},  {
  type: "column",
  markerType: "none",
  dataPoints: U[0].endOrange
  }
  ]
}
);

var chart8 = new CanvasJS.Chart("chartContainer8",{
      colorSet: "Overview GYBRO",
      title:{
        text: "Progress of Epidemic"
      },
      data: [
    {
      type: "stackedColumn",
      dataPoints: U[1].endGreen
    },  {
      type: "stackedColumn",
      dataPoints: U[1].endYellow
    },  {
      type: "stackedColumn",
      dataPoints: U[1].endBlue
    },  {
      type: "stackedColumn",
      dataPoints: U[1].endRed
    },  {
      type: "stackedColumn",
      dataPoints: U[1].endOrange
    }
            ]
  }
);

var chart9 = new CanvasJS.Chart("chartContainer9",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "line",
  markerType: "none",
  dataPoints: U[1].xendGreen

},  {
  type: "line",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[1].xendYellow
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[2].xendBlue
},  {
  type: "line",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[2].xendRed
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[2].xendOrange
  }
  ]
}
);


var chart10 = new CanvasJS.Chart("chartContainer10",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "line",
  markerType: "none",
  dataPoints: U[3].endGreen

},  {
  type: "line",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[3].endYellow
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[3].endBlue
},  {
  type: "line",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[3].endRed
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[3].endOrange
  }
  ]
}
);


var chart11 = new CanvasJS.Chart("chartContainer11",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "line",
  markerType: "none",
  dataPoints: U[4].endGreen

},  {
  type: "line",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[4].endYellow
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[4].endBlue
},  {
  type: "line",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[4].endRed
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[4].endOrange
  }
  ]
}
);


var chart12 = new CanvasJS.Chart("chartContainer12",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "line",
  markerType: "none",
  dataPoints: U[5].endGreen

},  {
  type: "line",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[5].endYellow
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[5].endBlue
},  {
  type: "line",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[5].endRed
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[5].endOrange
  }
  ]
}
);


var chart13 = new CanvasJS.Chart("chartContainer13",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "line",
  markerType: "none",
  dataPoints: U[6].endGreen

},  {
  type: "line",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[6].endYellow
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[6].endBlue
},  {
  type: "line",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[6].endRed
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[6].endOrange
  }
  ]
}
);


var chart14 = new CanvasJS.Chart("chartContainer14",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "line",
  markerType: "none",
  dataPoints: U[7].endGreen

},  {
  type: "line",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[7].endYellow
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[7].endBlue
},  {
  type: "line",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[7].endRed
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[7].endOrange
  }
  ]
}
);


var chart15 = new CanvasJS.Chart("chartContainer15",{
  colorSet: "Overview GYBRO",
  title:{
    text: "Progress of Epidemic"
  },
  axisY2: {
    title: "Y + R"
  },
  axisY: {
    title: "G + B + O"
  },
  data: [{
  type: "line",
  markerType: "none",
  dataPoints: U[8].endGreen

},  {
  type: "line",
  axisYType: "secondary",
  markerType: "none",
  dataPoints: U[8].endYellow
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[8].endBlue
},  {
  type: "line",
  markerType:"none",
  axisYType: "secondary",
  dataPoints: U[8].endRed
},  {
  type: "line",
  markerType: "none",
  dataPoints: U[8].endOrange
  }
  ]
}
);

var chart16 = new CanvasJS.Chart("chartContainer16",{
    colorSet: "Overview GYBRO",
    title:{
      text: "Total Population Counts"
    },
    axisY2: {
      title: "Y + R"
    },
    axisY: {
      title: "G + B + O"
    },
    data: [{
      type: "line",
      markerType: "none",
      dataPoints: M.endGreen
    },  {
      type: "line",
      axisYType: "secondary",
      markerType: "none",
      dataPoints: M.endYellow
    },  {
      type: "line",
      markerType: "none",
      dataPoints: M.endBlue
    },  {
      type: "line",
      markerType:"none",
      axisYType: "secondary",
      dataPoints: M.endRed
    },  {
      type: "line",
      markerType: "none",
      dataPoints: M.endOrange
    }]
});


var chart17 = new CanvasJS.Chart("chartContainer17", {
      animationEnabled: true,
      theme: "light2", // "light1", "light2", "dark1", "dark2"
      title:{
        text: "TOTAL Cases to Date - Entire Population"
  },
  axisY: {
    title: "Number of Clinical or Positive"
  },
  width:500,
  data: [{
    type: "column",
    showInLegend: true,
    legendMarkerColor: "grey",
    legendText: "Days since beginning",
    dataPoints: M.endCases
  }]
});


// chart 2 **********************************************



var chart18 = new CanvasJS.Chart("chartContainer18", {
  animationEnabled: true,
  theme: "light2", // "light1", "light2", "dark1", "dark2"
  title:{
    text: "Daily NEW Cases - entire Population"
  },
  axisY: {
    title: "Number of Clinical or Positive"
  },
  width:500,
  data: [{
    type: "column",
    showInLegend: true,
    legendMarkerColor: "grey",
    legendText: "Days since beginning",
    dataPoints: M.endRedDelta
}]
});


// CHART3 **********************************************************


var chart19 = new CanvasJS.Chart("chartContainer19", {
animationEnabled: true,
zoomEnabled: true,
theme: "light2", // "light1", "light2", "dark1", "dark2"
title:{
  text: "Percent Increase Total Cases - Entire Population"
},
axisY: {
  title: "Percent Increase"
},
data: [{
  type: "line",
  showInLegend: true,
  legendMarkerColor: "grey",
  legendText: "Days since beginning",
  dataPoints: M.endVelocity
}]
});


// *********************************************************************************
// CHART 4 - GREEN YELLOE BLUE RED over time



var chart20 = new CanvasJS.Chart("chartContainer20", {
//  theme: "light1",
  colorSet: "Overview GYBRO",
  title:{
    text: "Daily Population Composition of Epidemic"
  },
    data: [
  {
    type: "stackedColumn",
    dataPoints: M.endGreen
  },  {
    type: "stackedColumn",
    dataPoints: M.endYellow
  },  {
    type: "stackedColumn",
    dataPoints: M.endBlue
  },  {
    type: "stackedColumn",
    dataPoints: M.endRed
  },  {
    type: "stackedColumn",
    dataPoints: M.endOrange
  }
    ]
  }
);






// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

//handleFiles("data.csv");
var lines = [];

function handleFiles(files) {
	// Check for the various File API support.
	if (window.FileReader) {
		// FileReader are supported.
		getAsText(files[0]);
	} else {
		alert('FileReader are not supported in this browser.');
	}
}

function getAsText(fileToRead) {
	var reader = new FileReader();
	// Handle errors load
	reader.onload = loadHandler;
	reader.onerror = errorHandler;
	// Read file into memory as UTF-8
	reader.readAsText(fileToRead);
}
function loadHandler(event) {
	var csv = event.target.result;
	processData(csv);
}

function processData(csv) {
    var allTextLines = csv.split(/\r\n|\n/);
    while (allTextLines.length) {
        lines.push(allTextLines.shift().split(','));
    }
	processLines();
//	drawOutput(lines);
}

function errorHandler(evt) {
    	if(evt.target.error.name == "NotReadableError") {
    		alert("Canno't read file !");
      }
}




</script>
</head>
<
</html>
